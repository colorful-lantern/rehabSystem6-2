<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <title>ãƒã‚¤ãƒªãƒãƒ“ãƒª-ãã‚‡ã†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: #c2e2ed;
            font-size: 16px;
        }

        #generalstatus {
            border-radius: 16px;
            padding-bottom: 0;
            position: relative;
            overflow: hidden;
            min-height: 350px;
            background: none !important;
        }

        .confetti {
            position: absolute;
            width: 1rem;
            height: 1rem;
            border-radius: 0.125rem;
            opacity: 0;
            pointer-events: none;
        }

        #dividestatus,
        #iconlegendstatus,
        #rankstatus {
            background: rgba(255, 255, 255, 1);
            border-radius: 16px 16px 16px 16px;
            padding-bottom: 0.75rem;
        }

        #container {
            background: #fff;
            border-radius: 50%;
            display: inline-block;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            width: 70vw;
            height: 70vw;
            max-width: 18.75rem;
            max-height: 18.75rem;
            position: relative; /* ç´™å¹é›ªã‚¨ãƒªã‚¢ã®ä½ç½®åŸºæº–ç”¨ */
        }

        .eachcontainer {
            background: #fff;
            border-radius: 0.75rem;
            margin: 0.25rem 0;
            min-height: 3rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 0.5rem;
        }

        #generalstatus,
        #generalstatus *:not(i):not(.bi):not(.navbar):not(.navbar-brand):not(nav):not(#footer):not(.fixed-bottom):not(.btn) {
            font-size: 1.3rem;
        }
        #generalstatus .fw-bold,
        #generalstatus .m-auto.fw-bold.mb-2 {
            font-size: 1.1rem;
        }
        #generalstatus .eachcontainer {
            font-size: 1.05rem;
        }
        #dividestatus span {
            font-size: 0.92em !important;
        }

        /* è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .self-training-btn-default {
            border-radius: 8px;
            font-size: 1rem;
            padding: 0.6rem;
            background-color: #f0f0f0;
            border-color: #dddddd;
            color: #808080;
            font-weight: bold;
        }
        
        .self-training-btn-completed {
            border-radius: 8px;
            font-size: 1rem;
            padding: 0.6rem;
            background-color: #e6f7e6;
            border-color: #d1f2d1;
            color: #155724;
            font-weight: bold;
        }

        /* ç¾åœ¨ã®ãƒ©ãƒ³ã‚¯è¡¨ç¤ºç”¨ã®å¹ãå‡ºã—ã‚¹ã‚¿ã‚¤ãƒ« */
        .current-rank-indicator {
            position: relative;
            display: inline-block;
            padding: 4px 8px;
            background-color: #495057;
            color: white;
            border-radius: 8px;
            font-size: 0.65rem;
            font-weight: bold;
            margin-top: 8px;
            white-space: nowrap;
        }
        
        .current-rank-indicator::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid var(--indicator-color, #495057);
        }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg" style="background-color: #c2e2ed;">
      <div class="container-fluid d-flex m-auto">
        <p class="navbar-brandfw-bold fw-bold fs-3 text-black ms-1 my-1 me-0" id="title">ãƒã‚¤ãƒªãƒãƒ“ãƒª</p>
      </div>
    </nav>

    <div id="generalstatus" class="m-2 text-center">
      <div id="container" class="my-4 mx-auto">
        <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®å††ã®ä¸­ã§ç´™å¹é›ªã‚’èˆã‚ã›ã‚‹ã‚¨ãƒªã‚¢ -->
        <div id="cracker-animation-area-card" class="confetti-animation-area" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; overflow: hidden; pointer-events: none; z-index: 10; display: none;"></div>
      </div>

      <!-- ç¯€ç›®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ï¼ˆè¡¨ç¤ºæ¡ä»¶ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰ -->
      <div id="milestone-message" class="p-3 my-2 text-center" style="max-width: 90%; margin: 0 auto; min-width: 16.25rem; background: rgba(255, 255, 255, 1); border-radius: 16px; display: none;">
        <div class="container-fluid">
          <div class="d-flex align-items-center justify-content-start mb-2">
            <div class="flex-shrink-0">
              <i class="bi bi-calendar-check text-primary" style="font-size: 2.5rem;"></i>
            </div>
            <div class="flex-grow-1 text-center ms-4">
              <span class="fw-bold text-primary" style="font-size: 1.3rem; line-height: 1.4;" id="milestone-message-text"></span>
            </div>
          </div>
        </div>
      </div>

      <div id="dividestatus" class="p-2 my-2 text-center" style="max-width: 90%; margin: 0 auto; min-width: 16.25rem;">
        <div class="container-fluid">
          <div class="text-start mb-2">
            <span class="fw-bold" style="font-size: 1.1rem;">ä»Šæ—¥ã®ãƒªãƒãƒ“ãƒª</span>
          </div>
            <div class="row mb-1 justify-content-center text-center" id="rehab-row">
            <div class="col-6 px-1 rehab-block" data-rehab="rehabilitation1">
              <span style="font-size: 0.92em; white-space: nowrap;">ç†å­¦ç™‚æ³•</span>
              <div id="each0" class="eachcontainer"></div>
            </div>
            <div class="col-6 px-1 rehab-block" data-rehab="rehabilitation2">
              <span style="font-size: 0.92em; white-space: nowrap;">è¨€èªç™‚æ³•</span>
              <div id="each1" class="eachcontainer"></div>
            </div>
            <div class="col-6 px-1 rehab-block" data-rehab="rehabilitation3">
              <span style="font-size: 0.92em; white-space: nowrap;">ä½œæ¥­ç™‚æ³•</span>
              <div id="each2" class="eachcontainer"></div>
            </div>
            <div class="col-6 px-1 rehab-block" data-rehab="rehabilitation4">
              <span style="font-size: 0.92em; white-space: nowrap;">å¿ƒç†ç™‚æ³•</span>
              <div id="each3" class="eachcontainer"></div>
            </div>
          </div>
          
          <!-- è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
          <div class="row mb-1 justify-content-center text-center" id="self-training-section" style="display: none;">
            <div class="col-12 px-1">
              <div class="d-flex align-items-center justify-content-center mb-2">
                <span style="font-size: 0.92rem; color: #000000;">è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</span>
              </div>
              <button id="self-training-btn" class="w-100 self-training-btn-default">
                <i class="bi bi-plus-circle me-2"></i>ãã‚ãã™ã‚‹
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="rankstatus" class="p-2 my-2 text-center" style="max-width: 90%; margin: 0 auto; min-width: 16.25rem;">
        <div class="container-fluid">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="fw-bold" style="font-size: 1.2rem;">ã‚ãªãŸã®ãƒ©ãƒ³ã‚¯</span>
            <span class="fw-bold badge rounded-pill" style="font-size: 1.4rem;"></span>
          </div>
          <div class="progress mb-1 mt-3" style="height: 10px;">
            <div class="progress-bar" role="progressbar" style="width: 60%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <div class="d-flex align-baseline justify-content-end m-0 p-0" style="font-size: 1rem; color: #666; transition: opacity 0.4s ease-in-out;"></div>
          
          <!-- ãƒ©ãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º -->
          <!-- <div class="mt-3 mb-2">
            <div class="table-responsive">
              <table class="table table-borderless m-auto" style="max-width: 400px;">
                <tbody>
                  <tr id="rank-names-row">
                    <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #495057; font-size: 0.8rem;">ãƒ“ã‚®ãƒŠãƒ¼</span></td>
                    <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #b8860b; font-size: 0.8rem;">ãƒ–ãƒ­ãƒ³ã‚º</span></td>
                    <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #708090; font-size: 0.8rem;">ã‚·ãƒ«ãƒãƒ¼</span></td>
                    <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #daa520; font-size: 0.8rem;">ã‚´ãƒ¼ãƒ«ãƒ‰</span></td>
                    <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #4a4a4a; font-size: 0.8rem;">ãƒ—ãƒ©ãƒãƒŠ</span></td>
                  </tr>
                  <tr id="rank-status-row-index"> -->
                    <!-- ãƒ©ãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³/ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã“ã“ã«å‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                  <!-- </tr>
                </tbody>
              </table>
            </div>
          </div> -->
          
          <!-- ãƒãƒƒã‚¸ã‚’è¦‹ã‚‹ãƒœã‚¿ãƒ³ -->
          <div class="mt-2" id="rank-info">
            <div class="text-center">
              <button id="rankDetailsBtn" class="btn btn-outline-primary" style="border-radius: 8px; font-size: 1rem; padding: 0.6rem 1.2rem;">
                <i class="bi bi-award me-2"></i>ãƒãƒƒã‚¸ã‚’è¦‹ã‚‹
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- <div id="iconlegendstatus" class="p-2 mt-2 text-center" style="max-width: 90%; margin: 0 auto; min-width: 16.25rem;">
          <div class="container-fluid m-0 p-0">
            <button class="btn btn-link text-secondary fw-bold ms-1" type="button"
              data-bs-toggle="collapse" data-bs-target="#icon-legend"
              aria-expanded="false" aria-controls="icon-legend"
              style="text-decoration:none; font-size:1.1rem;">
              ã‚¢ã‚¤ã‚³ãƒ³ã®æ„å‘³ <span id="icon-legend-arrow">â–¼</span>
            </button>
            <div class="collapse" id="icon-legend">
              <table class="table table-borderless m-auto align-middle" style="max-width: 400px;">
                <tbody>
                  <tr>
                    <td class="text-center align-middle" style="width: 48px; vertical-align: middle;">
                      <i class="bi bi-x-circle fs-4 text-secondary"></i>
                    </td>
                    <td class="text-start align-middle fs-6" style="vertical-align: middle;">
                      ã¾ã ãƒªãƒãƒ“ãƒªã«å–ã‚Šçµ„ã‚“ã§ã„ã¾ã›ã‚“ã€‚
                    </td>
                  </tr>
                  <tr>
                    <td class="text-center align-middle" style="width: 48px; vertical-align: middle;">
                      <i class="bi bi-check-circle-fill fs-4 text-success"></i>
                    </td>
                    <td class="text-start align-middle fs-6" style="vertical-align: middle;">
                      ãƒªãƒãƒ“ãƒªã«å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div> -->
      
    <!-- è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal fade" id="selfTrainingModal" tabindex="-1" aria-labelledby="selfTrainingModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="selfTrainingModalLabel">
              <i class="bi bi-journal-text me-2" style="color: #6f42c1;"></i>
              è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="selfTrainingText" class="form-label">ãã‚‡ã†ã®è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®å†…å®¹</label>
              <textarea class="form-control" id="selfTrainingText" rows="4" 
                        maxlength="200" placeholder="ä¾‹ï¼š30åˆ†é–“ã®ã‚¹ãƒˆãƒ¬ãƒƒãƒã‚’è¡Œã„ã¾ã—ãŸã€‚" style="border-color: #b0b0b0;"></textarea>
              <div class="form-text">
                <span id="charCount">0</span>/200æ–‡å­—
              </div>
            </div>
            <div class="alert alert-info" role="alert">
              <i class="bi bi-info-circle me-2"></i>
              æ–‡ç« ã¯90æ—¥é–“ä¿å­˜ã•ã‚Œã¾ã™ã€‚
            </div>
          </div>
          <div class="modal-footer">
            <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button> -->
            <button type="button" class="btn btn-danger me-auto" id="deleteSelfTraining" style="display: none;">
              <i class="bi bi-trash me-2"></i>è¨˜éŒ²ã‚’æ¶ˆã™
            </button>
            <button type="button" class="btn btn-primary" id="saveSelfTraining">
              <i class="bi bi-check-circle me-2"></i>è¨˜éŒ²ã™ã‚‹
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ãƒ©ãƒ³ã‚¯è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal fade" id="rankDetailsModal" tabindex="-1" aria-labelledby="rankDetailsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="rankDetailsModalLabel">
              <i class="bi bi-award me-2" style="color: #daa520;"></i>
              ãƒ©ãƒ³ã‚¯ãƒ»ãƒãƒƒã‚¸è©³ç´°
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- ãƒ©ãƒ³ã‚¯ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div class="mb-4">
              <div class="text-start mb-3">
                <span class="fw-bold" style="font-size: 1.3rem;">ãƒ©ãƒ³ã‚¯ä¸€è¦§</span>
              </div>
              <div class="table-responsive">
                <table class="table table-borderless m-auto" style="max-width: 400px;">
                  <tbody>
                    <tr id="rank-names-row-modal">
                      <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #495057; font-size: 0.9rem;">ãƒ“ã‚®ãƒŠãƒ¼</span></td>
                      <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #b8860b; font-size: 0.9rem;">ãƒ–ãƒ­ãƒ³ã‚º</span></td>
                      <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #708090; font-size: 0.9rem;">ã‚·ãƒ«ãƒãƒ¼</span></td>
                      <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #daa520; font-size: 0.9rem;">ã‚´ãƒ¼ãƒ«ãƒ‰</span></td>
                      <td class="text-center p-1"><span class="badge rounded-pill text-white" style="background-color: #4a4a4a; font-size: 0.9rem;">ãƒ—ãƒ©ãƒãƒŠ</span></td>
                    </tr>
                    <tr id="rank-status-row-modal">
                      <!-- ãƒ©ãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³/ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã“ã“ã«å‹•çš„ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            
            <!-- ãƒ©ãƒ³ã‚¯ã«ã¤ã„ã¦ã®ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ -->
            <div class="mt-3">
              <div class="container-fluid m-0 p-0">
                <button class="btn btn-link text-secondary fw-bold ms-1" type="button"
                  data-bs-toggle="collapse" data-bs-target="#rank-explanation-modal"
                  aria-expanded="false" aria-controls="rank-explanation-modal"
                  style="text-decoration:none; font-size:1.2rem;">
                  ãƒ©ãƒ³ã‚¯ã«ã¤ã„ã¦ <span id="rank-explanation-arrow-modal">â–¼</span>
                </button>
                <div class="collapse" id="rank-explanation-modal">
                  <div class="card mt-2" style="border-radius: 12px;">
                    <div class="card-body">
                      <h6 class="card-title text-center"><i class="bi bi-award fs-4"></i> ãƒ©ãƒ³ã‚¯ã‚·ã‚¹ãƒ†ãƒ </h6>
                      <p class="card-text text-center" style="font-size: 1.1rem;">1æ—¥ã®ãƒªãƒãƒ“ãƒªã‚’ã™ã¹ã¦å®Œäº†ã™ã‚‹ã¨1ãƒã‚¤ãƒ³ãƒˆãŸã¾ã‚Šã¾ã™ã€‚<br>åˆè¨ˆãƒã‚¤ãƒ³ãƒˆã«å¿œã˜ã¦ã€5ã¤ã®ãƒ©ãƒ³ã‚¯ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
                      
                      <!-- ãƒ©ãƒ³ã‚¯ä¸€è¦§ -->
                      <div class="alert alert-info m-1 p-3">
                        <div class="text-center">
                          <strong style="font-size: 1.1rem;">ãƒ©ãƒ³ã‚¯ä¸€è¦§</strong><br>
                          <div style="font-size: 1rem; line-height: 2; margin-top: 12px;">
                            <span class="badge rounded-pill text-white" style="background-color: #495057; font-size: 1rem;">ãƒ“ã‚®ãƒŠãƒ¼</span>ï¼š0ã€œ9ãƒã‚¤ãƒ³ãƒˆ<br>
                            <span class="badge rounded-pill text-white" style="background-color: #b8860b; font-size: 1rem;">ãƒ–ãƒ­ãƒ³ã‚º</span>ï¼š10ã€œ29ãƒã‚¤ãƒ³ãƒˆ<br>
                            <span class="badge rounded-pill text-white" style="background-color: #708090; font-size: 1rem;">ã‚·ãƒ«ãƒãƒ¼</span>ï¼š30ã€œ59ãƒã‚¤ãƒ³ãƒˆ<br>
                            <span class="badge rounded-pill text-white" style="background-color: #daa520; font-size: 1rem;">ã‚´ãƒ¼ãƒ«ãƒ‰</span>ï¼š60ã€œ99ãƒã‚¤ãƒ³ãƒˆ<br>
                            <span class="badge rounded-pill text-white" style="background-color: #4a4a4a; font-size: 1rem;">ãƒ—ãƒ©ãƒãƒŠ</span>ï¼š100ãƒã‚¤ãƒ³ãƒˆä»¥ä¸Š
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
          </div>
        </div>
      </div>
    </div>

    <div id="footer" class="container-fluid">
      <div class="fixed-bottom bg-white m-auto"
           style="border-radius: 26px; left: 0; right: 0; width: 95%; max-width: 600px; bottom: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.18);">
        <div class="row m-auto p-0" style="border-radius: 16px;">
          <div class="col-3">
            <div id="homebtn" class="text-center m-auto">
              <a href="index.html" class="btn btn-link text-primary text-decoration-none text-nowrap" style="font-size: 1.2rem;">
                <i class="bi bi-house-fill fw-bold" style="font-size: 2rem;"></i><br>
              ãã‚‡ã†</a>
            </div>
          </div>
          <div class="col-3">
            <div id="calbtn" class="text-center m-auto">
              <a href="calender.html" class="btn btn-link text-black text-decoration-none text-nowrap" style="font-size: 1.2rem;">
                <i class="bi bi-calendar2-week fw-bold" style="font-size: 2rem;"></i><br>
              ãã‚ã</a>
            </div>
          </div>
          <div class="col-3">
            <div id="explainbtn" class="text-center m-auto">
              <a href="explain.html" class="btn btn-link text-black text-decoration-none text-nowrap" style="font-size: 1.2rem;">
                <i class="bi bi-question-circle fw-bold" style="font-size: 2rem;"></i><br>
              ä½¿ã„æ–¹</a>
            </div>
          </div>
          <div class="col-3">
            <div id="settingbtn" class="text-center m-auto">
              <a href="setting.html" class="btn btn-link text-black text-decoration-none text-nowrap" style="font-size: 1.2rem;">
              <i class="bi bi-gear-fill fw-bold" style="font-size: 2rem;"></i><br>
              è¨­å®š</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div style="height: 200px;"></div>

    <script src="js/config.js"></script>
    <script src="js/progressbar.js"></script>
    <script src="js/script.js"></script>
    <script src="js/self_training_test.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const confettiContainer = document.getElementById('cracker-animation-area-card');
            const generalStatus = document.getElementById('generalstatus');
            let confettiIntervalId = null;

            const confettiColors = [
                '#FFD700', '#FF69B4', '#00CED1', '#7FFF00', '#FF8C00', '#9370DB', 
                '#FFFF00', '#ADFF2F', '#1E90FF', '#FA8072', '#BA55D3', '#00FA9A', 
                '#FFDAB9', '#6495ED', '#FFDEAD'
            ];

            function createConfetti() {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.backgroundColor = confettiColors[anime.random(0, confettiColors.length - 1)];
                
                // å††ã®ä¸Šéƒ¨ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ãªæ°´å¹³ä½ç½®ã§é–‹å§‹
                confetti.style.left = `${anime.random(0, confettiContainer.offsetWidth - 8)}px`;
                confetti.style.top = `-10px`;
                confettiContainer.appendChild(confetti);

                anime({
                    targets: confetti,
                    translateY: confettiContainer.offsetHeight + 10, // ä¸Šã‹ã‚‰ä¸‹ã¸è½ä¸‹
                    translateX: anime.random(-20, 20), // å°‘ã—å·¦å³ã«æºã‚Œã‚‹
                    rotate: anime.random(0, 720), // å›è»¢
                    opacity: [1, 0.5, 0], // é€æ˜åº¦å¤‰åŒ–
                    duration: anime.random(1000, 2000), // è½ä¸‹æ™‚é–“ã‚’çŸ­ç¸®ï¼ˆé€Ÿåº¦ã‚¢ãƒƒãƒ—ï¼‰
                    easing: 'linear', // è‡ªç”±è½ä¸‹
                    complete: function(anim) {
                        anim.animatables[0].target.remove();
                    }
                });
            }

            const checkAndTriggerConfetti = () => {
                const nmboftrue = parseInt(localStorage.getItem('nmboftrue'), 10);
                const numberofClass = parseInt(localStorage.getItem('numberofClass'), 10);
                const conditionMet = !isNaN(nmboftrue) && !isNaN(numberofClass) && nmboftrue === numberofClass;

                if (conditionMet) {
                    confettiContainer.style.display = 'block';
                    document.body.style.backgroundImage = 'none';
                    document.body.style.backgroundColor = '#c2e2ed';

                    if (confettiIntervalId === null) {
                        confettiIntervalId = setInterval(createConfetti, 120); // é–“éš”ã‚’çŸ­ãã—ã¦æ•°ã‚’å¢—ã‚„ã™
                    }
                } else {
                    confettiContainer.style.display = 'none';
                    document.body.style.backgroundColor = '#c2e2ed';
                    document.body.style.backgroundImage = 'radial-gradient(circle, #ffffff 12px, transparent 5px),';
                    document.body.style.backgroundSize = '40px 40px, 60px 60px, 90px 90px';
                    document.body.style.backgroundPosition = '0 0, 20px 20px, 45px 45px';

                    if (confettiIntervalId !== null) {
                        clearInterval(confettiIntervalId);
                        confettiIntervalId = null;
                        const existingConfetti = confettiContainer.querySelectorAll('.confetti');
                        existingConfetti.forEach(c => c.remove());
                    }
                }
            };

            checkAndTriggerConfetti();
            
            // ä¼‘æ—¥å½“æ—¥ã®è¡¨ç¤ºåˆ¶å¾¡ã‚’æœ€åˆã«å®Ÿè¡Œ
            if (typeof handleRestDayDisplay === 'function') {
                try {
                    handleRestDayDisplay();
                } catch (error) {
                    console.error('ä¼‘æ—¥è¡¨ç¤ºå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                }
            }
            
            // æ³¨æ„: é€£ç¶šè¨˜éŒ²ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ç¯€ç›®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºã¯
            // script.jsã®DOMContentLoadedã‚¤ãƒ™ãƒ³ãƒˆã§ä¸€å…ƒç®¡ç†ã•ã‚Œã¾ã™
            
            setInterval(() => {
                checkAndTriggerConfetti();
                // ç¯€ç›®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å®šæœŸæ›´æ–°ã—ãªã„ï¼ˆãã®æ—¥ã®é–“ã¯å›ºå®šè¡¨ç¤ºï¼‰
            }, 5000);
        });
    </script>
    
    <!-- è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ©Ÿèƒ½ -->
    <script>
        // è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ©Ÿèƒ½ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const selfTrainingSection = document.getElementById('self-training-section');
            const selfTrainingBtn = document.getElementById('self-training-btn');
            const selfTrainingModal = new bootstrap.Modal(document.getElementById('selfTrainingModal'));
            const selfTrainingText = document.getElementById('selfTrainingText');
            const charCount = document.getElementById('charCount');
            const saveSelfTrainingBtn = document.getElementById('saveSelfTraining');
            
            // è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯
            function checkSelfTrainingEnabled() {
                const isEnabled = localStorage.getItem(SELF_TRAINING_CONFIG.REHAB_KEY) === 'true';
                if (isEnabled) {
                    selfTrainingSection.style.display = 'block';
                    updateSelfTrainingButton();
                } else {
                    selfTrainingSection.style.display = 'none';
                }
            }
            
            // è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            function updateSelfTrainingButton() {
                const today = new Date().toISOString().split('T')[0];
                const hasRecord = SelfTrainingManager.hasRecord(today);
                
                if (hasRecord) {
                    selfTrainingBtn.innerHTML = '<i class="bi bi-check-circle-fill me-2 text-success"></i>è¨˜éŒ²æ¸ˆã¿';
                    selfTrainingBtn.className = 'btn w-100 self-training-btn-completed';
                    selfTrainingBtn.disabled = false; // å†ç·¨é›†å¯èƒ½
                } else {
                    selfTrainingBtn.innerHTML = '<i class="bi bi-plus-circle me-2"></i>è¨˜éŒ²ã™ã‚‹';
                    selfTrainingBtn.className = 'btn w-100 self-training-btn-default';
                    selfTrainingBtn.disabled = false;
                }
            }
            
            // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
            selfTrainingText.addEventListener('input', function() {
                const count = this.value.length;
                charCount.textContent = count;
                
                if (count > 200) {
                    charCount.style.color = '#dc3545';
                } else if (count > 150) {
                    charCount.style.color = '#ffc107';
                } else {
                    charCount.style.color = '#6c757d';
                }
            });
            
            // è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
            selfTrainingBtn.addEventListener('click', function() {
                const today = new Date().toISOString().split('T')[0];
                const existingText = SelfTrainingManager.getTextContent(today) || '';
                const deleteSelfTrainingBtn = document.getElementById('deleteSelfTraining');
                
                // æ—¢å­˜ã®ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Œã°è¡¨ç¤º
                selfTrainingText.value = existingText;
                charCount.textContent = existingText.length;
                
                // å‰Šé™¤ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
                if (existingText || SelfTrainingManager.hasRecord(today)) {
                    deleteSelfTrainingBtn.style.display = 'inline-block';
                } else {
                    deleteSelfTrainingBtn.style.display = 'none';
                }
                
                selfTrainingModal.show();
            });
            
            // å‰Šé™¤ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
            const deleteSelfTrainingBtn = document.getElementById('deleteSelfTraining');
            deleteSelfTrainingBtn.addEventListener('click', function() {
                if (confirm('ä»Šæ—¥ã®è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    const today = new Date().toISOString().split('T')[0];
                    
                    // è¨˜éŒ²å‰Šé™¤
                    const deleteResult = SelfTrainingManager.deleteRecord(today);
                    
                    if (deleteResult) {
                        selfTrainingModal.hide();
                        updateSelfTrainingButton();
                        
                        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                        const successAlert = document.createElement('div');
                        successAlert.className = 'alert alert-warning alert-dismissible fade show position-fixed';
                        successAlert.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
                        successAlert.innerHTML = `
                            <i class="bi bi-trash-fill me-2"></i>
                            è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸ
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        `;
                        document.body.appendChild(successAlert);
                        
                        // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
                        setTimeout(() => {
                            if (successAlert.parentNode) {
                                successAlert.remove();
                            }
                        }, 3000);
                        
                        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚„çµ±è¨ˆã®æ›´æ–°ã‚’ãƒˆãƒªã‚¬ãƒ¼
                        if (typeof saveTrueCountToLocalStorage === 'function') {
                            saveTrueCountToLocalStorage();
                        }
                    } else {
                        alert('è¨˜éŒ²ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                    }
                }
            });
            
            // è¨˜éŒ²ä¿å­˜
            saveSelfTrainingBtn.addEventListener('click', function() {
                const text = selfTrainingText.value.trim();
                const today = new Date().toISOString().split('T')[0];
                
                if (text.length === 0) {
                    alert('è¨˜éŒ²å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                if (text.length > 200) {
                    alert('è¨˜éŒ²å†…å®¹ã¯200æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // è¨˜éŒ²ä¿å­˜
                const saveResult = SelfTrainingManager.saveRecord(today, text);
                
                if (saveResult) {
                    selfTrainingModal.hide();
                    updateSelfTrainingButton();
                    
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                    const successAlert = document.createElement('div');
                    successAlert.className = 'alert alert-success alert-dismissible fade show position-fixed';
                    successAlert.style.cssText = 'position: fixed; left: 50%; top: 10%; transform: translate(-50%, -50%); z-index: 9999; max-width: 700px;';
                    successAlert.innerHTML = `
                        <i class="bi bi-check-circle-fill me-2"></i>
                        è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    document.body.appendChild(successAlert);
                    
                    // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
                    setTimeout(() => {
                        if (successAlert.parentNode) {
                            successAlert.remove();
                        }
                    }, 3000);
                    
                    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚„çµ±è¨ˆã®æ›´æ–°ã‚’ãƒˆãƒªã‚¬ãƒ¼
                    if (typeof saveTrueCountToLocalStorage === 'function') {
                        saveTrueCountToLocalStorage();
                    }
                } else {
                    alert('è¨˜éŒ²ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                }
            });
            
            // åˆæœŸçŠ¶æ…‹ã®ãƒã‚§ãƒƒã‚¯
            if (typeof SELF_TRAINING_CONFIG !== 'undefined') {
                checkSelfTrainingEnabled();
                
                // è¨­å®šå¤‰æ›´ã‚’ç›£è¦–ï¼ˆå®šæœŸãƒã‚§ãƒƒã‚¯ï¼‰
                setInterval(checkSelfTrainingEnabled, 1000);
            }
        });
    </script>
    
    <!-- ãƒ©ãƒ³ã‚¯è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ãƒ©ãƒ³ã‚¯è©³ç´°ãƒœã‚¿ãƒ³ã¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã®åˆæœŸåŒ–
            const rankDetailsBtn = document.getElementById('rankDetailsBtn');
            const rankDetailsModal = new bootstrap.Modal(document.getElementById('rankDetailsModal'));
            
            // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
            if (rankDetailsBtn) {
                rankDetailsBtn.addEventListener('click', function() {
                    // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ãƒ©ãƒ³ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡Œã‚’æ›´æ–°
                    updateModalRankStatus();
                    rankDetailsModal.show();
                });
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ãƒ©ãƒ³ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
            function updateModalRankStatus() {
                const modalRankStatusRow = document.getElementById('rank-status-row-modal');
                
                if (modalRankStatusRow) {
                    // script.jsã®é–¢æ•°ã‚’ç›´æ¥å‘¼ã³å‡ºã—ã¦ãƒ©ãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆ
                    if (typeof updateIndexRankDisplay === 'function') {
                        // ä¸€æ™‚çš„ã«ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®è¦ç´ ã‚’ä½œæˆã—ã¦ãƒ©ãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆ
                        const tempElement = document.createElement('tr');
                        tempElement.id = 'rank-status-row-index';
                        document.body.appendChild(tempElement);
                        
                        // ãƒ©ãƒ³ã‚¯è¡¨ç¤ºã‚’æ›´æ–°
                        updateIndexRankDisplay();
                        
                        // ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ã‚³ãƒ”ãƒ¼
                        modalRankStatusRow.innerHTML = tempElement.innerHTML;
                        
                        // ä¸€æ™‚è¦ç´ ã‚’å‰Šé™¤
                        document.body.removeChild(tempElement);
                    } else {
                        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åŸºæœ¬çš„ãªãƒ©ãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º
                        generateBasicRankIcons(modalRankStatusRow);
                    }
                }
            }
            
            // åŸºæœ¬çš„ãªãƒ©ãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
            function generateBasicRankIcons(targetRow) {
                const ranks = [
                    { name: 'ãƒ“ã‚®ãƒŠãƒ¼', icon: 'ğŸ¥‰', color: '#495057' },
                    { name: 'ãƒ–ãƒ­ãƒ³ã‚º', icon: 'ğŸ¥‰', color: '#b8860b' },
                    { name: 'ã‚·ãƒ«ãƒãƒ¼', icon: 'ğŸ¥ˆ', color: '#708090' },
                    { name: 'ã‚´ãƒ¼ãƒ«ãƒ‰', icon: 'ğŸ¥‡', color: '#daa520' },
                    { name: 'ãƒ—ãƒ©ãƒãƒŠ', icon: 'ğŸ‘‘', color: '#4a4a4a' }
                ];
                
                let html = '';
                ranks.forEach((rank, index) => {
                    html += `<td class="text-center p-1">
                        <span style="font-size: 1.5rem;">${rank.icon}</span>
                    </td>`;
                });
                
                targetRow.innerHTML = html;
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³åˆ¶å¾¡
            const collapseElModal = document.getElementById('rank-explanation-modal');
            const arrowModal = document.getElementById('rank-explanation-arrow-modal');
            
            if (collapseElModal && arrowModal) {
                collapseElModal.addEventListener('show.bs.collapse', function () {
                    arrowModal.textContent = 'â–²';
                });
                collapseElModal.addEventListener('hide.bs.collapse', function () {
                    arrowModal.textContent = 'â–¼';
                });
            }
        });
    </script>
    
    <!-- <script>
      document.addEventListener('DOMContentLoaded', function() {
        var collapseEl = document.getElementById('icon-legend');
        var arrow = document.getElementById('icon-legend-arrow');
        collapseEl.addEventListener('show.bs.collapse', function () {
          arrow.textContent = 'â–²';
        });
        collapseEl.addEventListener('hide.bs.collapse', function () {
          arrow.textContent = 'â–¼';
        });
      });
    </script> -->
  </body>
</html>
